<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ user_name }}'s Weather Forecasts</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1><i class="fas fa-user-circle"></i> {{ user_name }}'s Weather History</h1>
            <p>View all saved weather forecasts for {{ user_name }}</p>
            <a href="{{ url_for('main.index') }}" class="btn btn-primary">
                <i class="fas fa-home"></i> Back to Home
            </a>
        </header>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="messages">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">
                            <i class="fas fa-{{ 'check-circle' if category == 'success' else 'exclamation-triangle' }}"></i>
                            {{ message }}
                            <button class="alert-close" onclick="this.parentElement.remove()">×</button>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        {% if forecasts %}
            <!-- User's Forecasts -->
            {% for forecast in forecasts %}
            <div class="card">
                <div class="card-header">
                    <h2>
                        <i class="fas fa-map-marker-alt"></i> {{ forecast.city|title }}
                        <span class="timestamp">{{ forecast.timestamp.strftime('%Y-%m-%d %H:%M') }}</span>
                    </h2>
                </div>
                <div class="card-body">
                    <div class="forecast-grid">
                        {% for item in forecast.weather_data %}
                        <div class="forecast-item">
                            <div class="forecast-date">{{ item.dt_txt[:16] }}</div>
                            <div class="forecast-icon">
                                {% if item.weather and item.weather[0].icon %}
                                    <img src="https://openweathermap.org/img/wn/{{ item.weather[0].icon }}@2x.png" 
                                         alt="{{ item.weather[0].main }}">
                                {% endif %}
                            </div>
                            <div class="forecast-temp">{{ item.main.temp|round(1) }}°C</div>
                            <div class="forecast-desc">{{ item.weather[0].description|title }}</div>
                            <div class="forecast-humidity">
                                <i class="fas fa-tint"></i> {{ item.main.humidity }}%
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <!-- No Forecasts -->
            <div class="card">
                <div class="card-body text-center">
                    <i class="fas fa-cloud-meatball fa-3x text-muted"></i>
                    <h3>No Saved Forecasts</h3>
                    <p>{{ user_name }} hasn't saved any weather forecasts yet.</p>
                    <a href="{{ url_for('main.index') }}" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Get First Forecast
                    </a>
                </div>
            </div>
        {% endif %}

        <!-- Footer -->
        <footer class="footer">
            <p><i class="fas fa-heart text-red"></i> Made with Flask & OpenWeather API</p>
        </footer>
    </div>

    <script>
        // Auto-hide alerts after 5 seconds
        setTimeout(() => {
            document.querySelectorAll('.alert').forEach(alert => {
                alert.style.opacity = '0';
                setTimeout(() => alert.remove(), 300);
            });
        }, 5000);
    </script>
</body>
</html>
